<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ - –ú–∏–Ω–∏-–±–∏–ª—å—è—Ä–¥</title>
    
    <!-- –î–æ–±–∞–≤—å—Ç–µ Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCrSNE5Irp7On5PQfiKIKWtWsmrhnhwet4",
            authDomain: "billll-29d2e.firebaseapp.com",
            databaseURL: "https://billll-29d2e-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "billll-29d2e",
            storageBucket: "billll-29d2e.firebasestorage.app",
            messagingSenderId: "120025375875",
            appId: "1:120025375875:web:eb2b736a3119b432abe7b6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // –°–¥–µ–ª–∞–µ–º database –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è–Ω
        window.database = database;
        window.dbRef = ref;
        window.dbOnValue = onValue;
        window.dbSet = set;
    </script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .rules {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #3498db;
            margin: 15px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .table-container {
            overflow-x: auto;
            padding: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th {
            background: #34495e;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: bold;
            position: sticky;
            top: 0;
            cursor: pointer;
        }
        
        th:hover {
            background: #2c3e50;
        }
        
        .sort-indicator {
            margin-left: 5px;
            font-size: 12px;
        }
        
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        tr:hover {
            background: #e8f4f8;
        }
        
        .controls {
            padding: 20px;
            background: #ecf0f1;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .control-group {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        select, button, input {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        button.secondary {
            background: #95a5a6;
        }
        
        button.secondary:hover {
            background: #7f8c8d;
        }
        
        button.danger {
            background: #e74c3c;
        }
        
        button.danger:hover {
            background: #c0392b;
        }
        
        .rank-1 {
            background: #fff9c4 !important;
            font-weight: bold;
        }
        
        .rank-2 {
            background: #f5f5f5 !important;
        }
        
        .rank-3 {
            background: #ffecb3 !important;
        }
        
        .points {
            font-weight: bold;
            color: #e91e63;
        }
        
        .player-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .medal {
            font-size: 18px;
        }
        
        .gold { color: #ffd700; }
        .silver { color: #c0c0c0; }
        .bronze { color: #cd7f32; }
        
        .search-box {
            position: relative;
            margin-bottom: 15px;
        }
        
        .search-box input {
            padding-left: 40px;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
        }
        
        .sync-status {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-size: 14px;
            display: none;
        }
        
        .sync-status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .edit-form {
            display: none;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid #e9ecef;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .form-actions button {
            flex: 1;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∞ */
        .admin-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s;
            z-index: 100;
        }
        
        .admin-btn:hover {
            background: #e67e22;
            transform: scale(1.1);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∞–¥–º–∏–Ω–∞ */
        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .admin-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .admin-modal h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }
        
        .admin-modal input {
            margin-bottom: 15px;
        }
        
        .admin-modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .admin-modal-buttons button {
            flex: 1;
        }
        
        .admin-controls {
            display: none;
        }
        
        .admin-active .admin-controls {
            display: block;
        }
        
        .admin-locked {
            display: none;
        }
        
        .admin-active .admin-locked {
            display: block;
        }
        
        .admin-active .admin-unlocked {
            display: none;
        }
        
        .admin-message {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <button class="admin-btn" onclick="showAdminModal()">‚öôÔ∏è</button>
        
        <header>
            <h1>üèÜ –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ - –ú–∏–Ω–∏-–±–∏–ª—å—è—Ä–¥</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –æ—á–∫–æ–≤: –ü–æ–±–µ–¥–∞ = 2 –æ—á–∫–∞, –ü–æ—Ä–∞–∂–µ–Ω–∏–µ = 1 –æ—á–∫–æ</p>
        </header>
        
        <div class="rules">
            <strong>–ü—Ä–∞–≤–∏–ª–∞ —Ç—É—Ä–Ω–∏—Ä–∞:</strong>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>–ó–∞ –ø–æ–±–µ–¥—É –≤ –º–∞—Ç—á–µ –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç <strong>2 –æ—á–∫–∞</strong></li>
                <li>–ó–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ –≤ –º–∞—Ç—á–µ –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç <strong>1 –æ—á–∫–æ</strong></li>
                <li>–¢–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—á–∫–æ–≤</li>
                <li>–ü—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ –æ—á–∫–æ–≤ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥</li>
            </ul>
            <div id="sync-status" class="sync-status">
                <!-- –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <div class="table-container">
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞..." onkeyup="filterPlayers()">
            </div>
            
            <table id="tournament-table">
                <thead>
                    <tr>
                        <th width="50" onclick="sortTable('rank')">–ú–µ—Å—Ç–æ <span class="sort-indicator" id="sort-rank">‚ñº</span></th>
                        <th onclick="sortTable('name')">–£—á–∞—Å—Ç–Ω–∏–∫ <span class="sort-indicator" id="sort-name"></span></th>
                        <th width="80" onclick="sortTable('games')">–ò–≥—Ä—ã <span class="sort-indicator" id="sort-games"></span></th>
                        <th width="80" onclick="sortTable('wins')">–ü–æ–±–µ–¥—ã <span class="sort-indicator" id="sort-wins"></span></th>
                        <th width="80" onclick="sortTable('losses')">–ü–æ—Ä–∞–∂–µ–Ω–∏—è <span class="sort-indicator" id="sort-losses"></span></th>
                        <th width="80" onclick="sortTable('points')">–û—á–∫–∏ <span class="sort-indicator" id="sort-points">‚ñº</span></th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <tr>
                        <td colspan="6" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="controls">
            <!-- –ë–ª–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞—Ç—á–∞ - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–µ–Ω -->
            <div class="control-group">
                <h3>üéØ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç—á</h3>
                <select id="player1">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 1</option>
                </select>
                <select id="player2">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 2</option>
                </select>
                <select id="winner">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è</option>
                    <option value="player1">–ü–æ–±–µ–¥–∏–ª –ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫</option>
                    <option value="player2">–ü–æ–±–µ–¥–∏–ª –≤—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫</option>
                </select>
                <button onclick="registerMatch()">‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç—á</button>
            </div>
            
            <!-- –ë–ª–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö - —Å–∫—Ä—ã—Ç –ø–æ–¥ –ø–∞—Ä–æ–ª–µ–º -->
            <div class="control-group admin-controls">
                <h3>üîß –§—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                
                <div class="admin-unlocked">
                    <h4>‚úèÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞</h4>
                    <select id="edit-player" onchange="showEditForm()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</option>
                    </select>
                    
                    <div id="edit-form" class="edit-form">
                        <div class="form-row">
                            <div>
                                <label>–ò–≥—Ä—ã:</label>
                                <input type="number" id="edit-games" min="0">
                            </div>
                            <div>
                                <label>–ü–æ–±–µ–¥—ã:</label>
                                <input type="number" id="edit-wins" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label>–ü–æ—Ä–∞–∂–µ–Ω–∏—è:</label>
                                <input type="number" id="edit-losses" min="0">
                            </div>
                            <div>
                                <label>–û—á–∫–∏:</label>
                                <input type="number" id="edit-points" min="0">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button onclick="savePlayerEdit()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button class="secondary" onclick="cancelEdit()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <button class="danger" onclick="resetData()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                        <button class="secondary" onclick="logoutAdmin()">üö™ –í—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∞</button>
                    </div>
                </div>
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–≥–¥–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã -->
            <div class="control-group admin-locked">
                <div class="admin-message">
                    <h3>üîí –§—É–Ω–∫—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã</h3>
                    <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
                    <button onclick="showAdminModal()">üîë –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∞ -->
    <div id="admin-modal" class="admin-modal">
        <div class="admin-modal-content">
            <h2>üîê –î–æ—Å—Ç—É–ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            <input type="password" id="admin-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            <div class="admin-modal-buttons">
                <button onclick="checkAdminPassword()">–í–æ–π—Ç–∏</button>
                <button class="secondary" onclick="hideAdminModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É)
        const initialPlayers = [
            "–ë–∞—Ä—Ç–æ–∫ –û–ª—å–≥–∞", "–ë–µ–∫–µ–∑–∏–Ω –Ø—Ä–æ—Å–ª–∞–≤", "–ë–µ–ª—è–∫–æ–≤ –ò–≤–∞–Ω", "–ë–æ–±–∫–æ–≤–∞ –°–≤–µ—Ç–ª–∞–Ω–∞",
            "–ë—ã–≤—à–µ–≤ –í–∏–∫—Ç–æ—Ä", "–ë—ã–≤—à–µ–≤ –ì—Ä–∏–≥–æ—Ä–∏–π", "–ë—ã–≤—à–µ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è", "–ë—ã–≤—à–µ–≤–∞ –ù–∞—Ç–∞–ª—å—è",
            "–î–∞–Ω–∏–ª–æ–≤–∞ –û–ª—å–≥–∞", "–ñ—ë–ª—É–¥–µ–≤–∞ –ú–∞—Ä–∏–Ω–∞", "–ó–∞—Ö–∞—Ä–∏–∫–æ–≤–∞ –õ—é–±–æ–≤—å", "–ö–∞—Ä–∞–Ω–¥–∞—à–µ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è",
            "–ö–∞—Ä–ø–æ–≤–∞ –õ—é–±–æ–≤—å", "–ö–∏—Ä–∏—á–µ–Ω–∫–æ –ò–ª—å—è", "–ú—è–≥–∫–∏—Ö –í–ª–∞–¥", "–ú—É—Ö—Ç–∞—Ä–æ–≤ –î–∞–Ω–∏–∏–ª",
            "–ú—É—Ö—Ç–∞—Ä–æ–≤ –ò–ª—å—è", "–ú—É—Ö—Ç–∞—Ä–æ–≤ –≠–¥–≥–∞—Ä", "–ú—É—Ö—Ç–∞—Ä–æ–≤–∞ –ù–∞—Ç–∞–ª—å—è", "–ù–æ–≤–æ—Å–µ–ª–æ–≤ –î–∞–Ω–∏–∏–ª",
            "–ü—É–∑–∏–∫–æ–≤ –†–æ–º–∞–Ω", "–†–æ–≥–æ–≤ –ê–ª–µ–∫—Å–µ–π", "–†–æ–≥–æ–≤ –î–º–∏—Ç—Ä–∏–π", "–†–æ–≥–æ–≤ –†–æ–º–∞–Ω",
            "–†–æ–≥–æ–≤–∞ –õ–∏–ª–∏—è", "–†–æ–≥–æ–≤–∞ –ù–∞—Ç–∞–ª—å—è", "–†–æ–º–∞–Ω–æ–≤–∞ –ê–Ω—Ç–æ–Ω–∏–Ω–∞", "–°–ª–∞–≤–Ω–æ–≤–∞ –õ—é–±–æ–≤—å",
            "–°–æ–∫–æ–ª–æ–≤ –î–º–∏—Ç—Ä–∏–π", "–°–æ–∫–æ–ª–æ–≤–∞ –ê–ª–µ–Ω–∞", "–°–æ—Ä–æ–∫–∏–Ω–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è", "–£—Ç–∫–∏–Ω –î–º–∏—Ç—Ä–∏–π",
            "–£—Ç–∫–∏–Ω–∞ –ú–∞—Ä–∏—è", "–£—Å–∫–æ–≤–∞ –ê–Ω–Ω–∞", "–§—ë–¥–æ—Ä–æ–≤ –ò–ª—å—è", "–®–∏–≥–∞–µ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è"
        ].sort();

        let players = [];
        let currentSearch = '';
        let currentSort = { field: 'points', direction: 'desc' };
        let selectedPlayerId = null;
        let isAdmin = false;
        const ADMIN_PASSWORD = "admin123";

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω-–¥–æ—Å—Ç—É–ø–∞
        function showAdminModal() {
            document.getElementById('admin-modal').style.display = 'flex';
            document.getElementById('admin-password').focus();
        }

        function hideAdminModal() {
            document.getElementById('admin-modal').style.display = 'none';
            document.getElementById('admin-password').value = '';
        }

        function checkAdminPassword() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                activateAdminMode();
                hideAdminModal();
                showNotification('–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                document.getElementById('admin-password').value = '';
                document.getElementById('admin-password').focus();
            }
        }

        function activateAdminMode() {
            document.getElementById('main-container').classList.add('admin-active');
            updatePlayerSelects(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        }

        function logoutAdmin() {
            isAdmin = false;
            document.getElementById('main-container').classList.remove('admin-active');
            cancelEdit(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            showNotification('–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        function showSyncStatus(message, isError = false) {
            const statusElement = document.getElementById('sync-status');
            statusElement.textContent = message;
            statusElement.style.display = 'block';
            
            if (isError) {
                statusElement.classList.add('error');
            } else {
                statusElement.classList.remove('error');
            }
            
            if (!isError) {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 3000);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase
        function loadData() {
            const playersRef = window.dbRef(window.database, 'players');
            
            window.dbOnValue(playersRef, (snapshot) => {
                const data = snapshot.val();
                
                if (data) {
                    players = Object.values(data);
                    players.sort((a, b) => a.id - b.id);
                    showSyncStatus('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –æ–±–ª–∞–∫–∞');
                } else {
                    players = initialPlayers.map((name, index) => ({
                        id: index + 1,
                        name: name,
                        games: 0,
                        wins: 0,
                        losses: 0,
                        points: 0
                    }));
                    saveDataToFirebase();
                    showSyncStatus('‚úÖ –°–æ–∑–¥–∞–Ω—ã –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                }
                
                updateTable();
                updatePlayerSelects();
            }, (error) => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                showSyncStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', true);
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Firebase
        function saveDataToFirebase() {
            const playersObject = {};
            players.forEach(player => {
                playersObject[player.id] = player;
            });
            
            const playersRef = window.dbRef(window.database, 'players');
            
            window.dbSet(playersRef, playersObject)
                .then(() => {
                    console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Firebase');
                    showSyncStatus('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ–±–ª–∞–∫–æ');
                })
                .catch((error) => {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                    showSyncStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', true);
                });
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
        function sortTable(field) {
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = 'asc';
            }
            
            updateSortIndicators();
            updateTable();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        function updateSortIndicators() {
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.textContent = '';
            });
            
            const indicator = document.getElementById(`sort-${currentSort.field}`);
            if (indicator) {
                indicator.textContent = currentSort.direction === 'asc' ? '‚ñ≤' : '‚ñº';
            }
        }

        // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –∫ –Ω–∞—á–∞–ª—å–Ω—ã–º
        function resetData() {
            if (!isAdmin) {
                alert('–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É');
                return;
            }
            
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –í—Å–µ —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                players = initialPlayers.map((name, index) => ({
                    id: index + 1,
                    name: name,
                    games: 0,
                    wins: 0,
                    losses: 0,
                    points: 0
                }));
                saveDataToFirebase();
                cancelEdit();
                showNotification('–î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã –∫ –Ω–∞—á–∞–ª—å–Ω—ã–º');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function showEditForm() {
            if (!isAdmin) return;
            
            const playerSelect = document.getElementById('edit-player');
            const editForm = document.getElementById('edit-form');
            selectedPlayerId = parseInt(playerSelect.value);
            
            if (selectedPlayerId) {
                const player = players.find(p => p.id === selectedPlayerId);
                if (player) {
                    document.getElementById('edit-games').value = player.games;
                    document.getElementById('edit-wins').value = player.wins;
                    document.getElementById('edit-losses').value = player.losses;
                    document.getElementById('edit-points').value = player.points;
                    editForm.style.display = 'block';
                }
            } else {
                editForm.style.display = 'none';
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–≥—Ä–æ–∫–∞
        function savePlayerEdit() {
            if (!isAdmin || !selectedPlayerId) return;
            
            const player = players.find(p => p.id === selectedPlayerId);
            if (player) {
                const games = parseInt(document.getElementById('edit-games').value) || 0;
                const wins = parseInt(document.getElementById('edit-wins').value) || 0;
                const losses = parseInt(document.getElementById('edit-losses').value) || 0;
                const points = parseInt(document.getElementById('edit-points').value) || 0;
                
                if (wins + losses > games) {
                    alert('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ –∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–π –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä');
                    return;
                }
                
                if (wins > games || losses > games) {
                    alert('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ –∏–ª–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–π –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä');
                    return;
                }
                
                player.games = games;
                player.wins = wins;
                player.losses = losses;
                player.points = points;
                
                saveDataToFirebase();
                updateTable();
                cancelEdit();
                showNotification('–î–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
            }
        }

        // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function cancelEdit() {
            document.getElementById('edit-player').value = '';
            document.getElementById('edit-form').style.display = 'none';
            selectedPlayerId = null;
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –ø–æ–∏—Å–∫—É
        function filterPlayers() {
            currentSearch = document.getElementById('search-input').value.toLowerCase();
            updateTable();
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Ç—á–∞
        function registerMatch() {
            const player1Select = document.getElementById('player1');
            const player2Select = document.getElementById('player2');
            const winnerSelect = document.getElementById('winner');
            
            const player1Id = parseInt(player1Select.value);
            const player2Id = parseInt(player2Select.value);
            const winner = winnerSelect.value;
            
            if (!player1Id || !player2Id || !winner) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞—Ç—á–∞');
                return;
            }
            
            if (player1Id === player2Id) {
                alert('–ò–≥—Ä–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –∏–≥—Ä–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ —Å–µ–±—è');
                return;
            }
            
            const player1 = players.find(p => p.id === player1Id);
            const player2 = players.find(p => p.id === player2Id);
            
            player1.games++;
            player2.games++;
            
            if (winner === 'player1') {
                player1.wins++;
                player2.losses++;
                player1.points += 2;
                player2.points += 1;
            } else {
                player2.wins++;
                player1.losses++;
                player2.points += 2;
                player1.points += 1;
            }
            
            player1Select.value = '';
            player2Select.value = '';
            winnerSelect.value = '';
            
            saveDataToFirebase();
            updateTable();
            updatePlayerSelects();
            showNotification('–ú–∞—Ç—á —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        function updateTable() {
            const tableBody = document.getElementById('table-body');
            
            let filteredPlayers = players.filter(player => {
                if (currentSearch && !player.name.toLowerCase().includes(currentSearch)) {
                    return false;
                }
                return true;
            });
            
            filteredPlayers = filteredPlayers.sort((a, b) => {
                let aValue, bValue;
                
                switch (currentSort.field) {
                    case 'name':
                        aValue = a.name.toLowerCase();
                        bValue = b.name.toLowerCase();
                        break;
                    case 'games':
                        aValue = a.games;
                        bValue = b.games;
                        break;
                    case 'wins':
                        aValue = a.wins;
                        bValue = b.wins;
                        break;
                    case 'losses':
                        aValue = a.losses;
                        bValue = b.losses;
                        break;
                    case 'points':
                        aValue = a.points;
                        bValue = b.points;
                        break;
                    case 'rank':
                    default:
                        aValue = a.points;
                        bValue = b.points;
                        if (aValue === bValue) {
                            aValue = a.wins;
                            bValue = b.wins;
                        }
                        break;
                }
                
                if (currentSort.direction === 'asc') {
                    return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;
                } else {
                    return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;
                }
            });
            
            tableBody.innerHTML = '';
            
            if (filteredPlayers.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>';
                return;
            }
            
            filteredPlayers.forEach((player, index) => {
                const row = document.createElement('tr');
                
                let rank = index + 1;
                if (currentSort.field !== 'points' && currentSort.field !== 'rank') {
                    const sortedByPoints = [...filteredPlayers].sort((a, b) => {
                        if (b.points !== a.points) return b.points - a.points;
                        return b.wins - a.wins;
                    });
                    rank = sortedByPoints.findIndex(p => p.id === player.id) + 1;
                }
                
                if (rank === 1) row.classList.add('rank-1');
                if (rank === 2) row.classList.add('rank-2');
                if (rank === 3) row.classList.add('rank-3');
                
                let medal = '';
                if (rank === 1) medal = '<span class="medal gold">ü•á</span>';
                else if (rank === 2) medal = '<span class="medal silver">ü•à</span>';
                else if (rank === 3) medal = '<span class="medal bronze">ü•â</span>';
                
                row.innerHTML = `
                    <td>${rank}</td>
                    <td><div class="player-name">${medal} ${player.name}</div></td>
                    <td>${player.games}</td>
                    <td>${player.wins}</td>
                    <td>${player.losses}</td>
                    <td class="points">${player.points}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –∏–≥—Ä–æ–∫–æ–≤
        function updatePlayerSelects() {
            const player1Select = document.getElementById('player1');
            const player2Select = document.getElementById('player2');
            const editPlayerSelect = document.getElementById('edit-player');
            
            const currentPlayer1 = player1Select.value;
            const currentPlayer2 = player2Select.value;
            const currentEditPlayer = editPlayerSelect.value;
            
            player1Select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 1</option>';
            player2Select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ 2</option>';
            
            if (isAdmin) {
                editPlayerSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</option>';
            }
            
            const sortedPlayers = [...players].sort((a, b) => a.name.localeCompare(b.name));
            
            sortedPlayers.forEach(player => {
                const option1 = document.createElement('option');
                option1.value = player.id;
                option1.textContent = player.name;
                player1Select.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = player.id;
                option2.textContent = player.name;
                player2Select.appendChild(option2);
                
                if (isAdmin) {
                    const optionEdit = document.createElement('option');
                    optionEdit.value = player.id;
                    optionEdit.textContent = player.name;
                    editPlayerSelect.appendChild(optionEdit);
                }
            });
            
            player1Select.value = currentPlayer1;
            player2Select.value = currentPlayer2;
            
            if (isAdmin) {
                editPlayerSelect.value = currentEditPlayer;
                if (currentEditPlayer) {
                    showEditForm();
                }
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                filterPlayers();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∞
        document.getElementById('admin-password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAdminPassword();
            }
        });

        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ Firebase –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
        window.addEventListener('DOMContentLoaded', (event) => {
            setTimeout(() => {
                if (window.database) {
                    loadData();
                    updateSortIndicators();
                } else {
                    console.error('Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    showSyncStatus('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase', true);
                }
            }, 1000);
        });
    </script>
</body>
</html>
